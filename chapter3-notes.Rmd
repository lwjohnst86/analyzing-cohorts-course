```{r setup}
source("preamble.R")
```

# Chapter 3: Running the statistical techniques

**Objectives:**

- Learn to run some common statistic techniques on different datasets and research
questions
- Learn how to extract the relevant results from these stats methods
- Understand why its important to not use or even look at p-values in the output
- Know how to understand and interpret the results (we'll get to knowing what
exactly is most useful to present and show for higher impact)
- Importance of examining multiple levels of adjustment (unadjusted, minimally,
fully), and how this can inform what is going on in the relationship.
- Knowing how to choose/decide on what variables to adjust for

- Sources of bias (not at this stage) TODO: move to analysis or wrangling chapter?

- Comment about staying away from p-values... or maybe for chapter 4...?

## Lesson 1: Common statistical techniques used for analyzing cohorts

*Content*:

- Common statistical techniques:
    - mixed effects modeling
    - GEE (?)
    - cox proportional hazard models
    - linear regression
    - logistic regression
    - Poisson regression
    - Conditional logistic regression (for nested case-cohort designs)

*Exercises*:

- NE: Change variables scaling or transform them to see how the estimates change...
what does that mean for interpretation? (or lesson 4)

### Exercise: Type of statistical method is important, especially for longitudinal studies

Before the development of mixed effects modeling, analyzing longitudinal data
was fairly difficult. This was because the early methods, which typically were 
some type of ANOVA or simple regression, had an assumption of independence in the
data. But longitudinal data is not independent... A single individual can have 
multiple measures done over time and are thus dependent.

Take a look at the difference between using a logistic regression model compared
to a mixed effect model.

```{r logreg_mixed}
# TODO: Check to confirm exponentiating of output.
logistic_model <- glm(prevchd ~ totchol + period, data = framingham, family = binomial)
summary(logistic_model)$coef

# show this in lesson 4?
# tidy(logistic_model, conf.int = TRUE, exponentiate = TRUE) %>% 
#     select(term, estimate, conf.low, conf.high)

# TODO: This doesn't seem to converge, so need to look into it.
mixed_model <- glmer(prevchd ~ totchol + period + (1 | randid), data = framingham, family = binomial)
summary(mixed_model)$coef

# show this in lesson 4?
# tidy(mixed_model, conf.int = TRUE) %>% 
#     select(term, estimate, conf.low, conf.high)
```


## Lesson 2: Adjustment, confounding, and modelling.

*Exercises*:

- MCQ: Which options would be most appropriate for using various model selection techniques?
    - list different conditions with possible methods. {{I can't remember what I meant here..}}
- NE: Cross-validation of a model.
- MCQ/text: Describe different impact of adjusting, etc. including collider variables.
How does that change the interpretation? How can this influence the health impacts
if inappropriately published? (or in lesson 4)
- MCQ/text: What does it mean to adjust? (how does it change interpretation)

### Exercise: Understanding confounding pathways

{{MCQ, probably as a Bullet/TabExercise}}

- MCQ/text: Present a DAG of hypothesized variables and pathways. Which of the
following (or write out which) are the important variables to consider/adjust for.

The below diagram is a classic example of what confouding is. When a variable is 
linked in some way, either directly or indirectly, to both the exposure and the 
outcome, it is considered a confounder.

```{r simple_confounding}
grViz("
digraph {
    node [style = filled fillcolor = none]
    {
        rank = same
        Exposure [fillcolor = 'LightBlue'] 
        Outcome [fillcolor = 'OrangeRed']
    }
    Exposure -> Outcome
    Confounder -> {Exposure Outcome}
}")
```

This simple confounding example shows how each variable relates to each other in
hypothesized pathways. Understanding how variables confounded the relationship
between the exposure and the outcome is essential to drawing more accurate
inferences about the associations. Creating these DAGs of the hypothesized
pathways is a powerful tool to understanding what could be confounders, what
could be colliders, and what needs to be adjusted for. Which are more
appropriate choices:

```{r confouding_example}
grViz("
digraph {
    node [style = filled fillcolor = none]
    {
        rank = same
        BodyFat [fillcolor = 'LightBlue'] 
        CVD [fillcolor = 'OrangeRed']
    }
    BodyFat -> CVD
    Sex -> {BodyFat CVD Testosterone}
    Testosterone -> {BodyFat CVD}
}")
```

- Options: {{likely all answers will be correct.. or maybe rank them ...}}
    - Since sex influences testosterone and since both sex and testosterone
    are confounders, only need to adjust for either of these variables to control
    for the confounding pathway.
    - Adjust for both 
    - Add others {{finish}}
    
Using the pathway below, which variables, at a minimum, should you adjust for to
control maximally for potential bias in the model?

```{r confounder_complex}
grViz("
digraph {
    node [style = filled fillcolor = none]
    {
        rank = same
        BodyFat [fillcolor = 'LightBlue'] 
        CVD [fillcolor = 'OrangeRed']
    }
    BodyFat -> CVD
    Sex -> {BodyFat CVD Testosterone ExerciseType}
    Testosterone -> {BodyFat CVD}
    ExerciseType -> {BodyFat CVD}
}")
```

- Options:
    - All of them {{possible}}
    - Only sex {{posible}}
    - Only testosterone
    - Only exercise type
    - Either sex and testosterone or sex and exercise type {{possible}}
    
Consider the below graph. Which variables, at a minimum, should you adjust for?

```{r confounding_collider}
grViz("
digraph {
    node [style = filled fillcolor = none]
    {
        rank = same
        BodyFat [fillcolor = 'LightBlue'] 
        CVD [fillcolor = 'OrangeRed']
    }
    BodyFat -> CVD
    Sex -> {BodyFat CVD Testosterone ExerciseType}
    Testosterone -> {BodyFat CVD}
    ExerciseType -> {Testosterone BodyFat CVD}
}")
```

- Options:
    - All of them
    - Only sex {{possible}}
    - Only testosterone
    - Only exercise type
    - Either sex and testosterone or sex and exercise type or exercise and
    testosterone. {{definite}}
    
### Video explaining exercise above?

Go a bit into the math of why the answers for the above exercise.


## Lesson 3

*Exercises*:

- NE: Maybe exercise where some observations are removed and show how that impacts
the p-value...? to highlight how unreliable it is?







*Content*:

## Lesson 4




# Notes:

- Statistics (more of a review, expect them to know what they are doing):
    - Logistic regression
    - Mixed effects modelling
- Choice of statistic is dependent on question asked.
- In general, cohorts try to address questions such as:
    - "what type of exposures increase the risk of disease?"
    - "how much and how long do individuals need to be exposured to a risk factor
    to develop the disease?"
    - "For those that have a disease, how do they differ from those without?"
    - "Those that have more exposure over time, are they more likely to develop a disease?"
- These questions generally require some type of regression modelling in order to
estimate magnitude of association and the uncertainty around that association.




